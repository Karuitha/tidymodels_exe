---
title: "Height versus Weight"
subtitle: "Predicting Height from Weight Using Tidymodels"
author: "John Karuitha"
date: "`r Sys.Date()`"
output:
  rmdformats::material:
    highlight: kate
    code_folding: hide
---


```{r setup, include=FALSE}
library(knitr)
library(rmdformats)

## Global options
options(max.print="75")
opts_chunk$set(echo=TRUE,
	             cache=TRUE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=FALSE)
opts_knit$set(width=75)
```

## **Background**

```{r}
## Load required libraries
library(dslabs)
library(tidymodels)

## Load the data
data("heights")

heights$sex <- factor(heights$sex, levels = c("Male", "Female"))

## View data
head(heights)
nrow(heights)
```

## Train/Test Split

```{r}
split_object <- initial_split(heights, prop = 0.7, strata = sex)

height_train <- split_object %>% training()

height_test <- split_object %>% testing()
```


## Set Regression Model

```{r}
logistic_model <- logistic_reg() %>% set_engine("glm") %>% set_mode("classification")
```

## Run the Logistic Model for sex ~ height

```{r}
logistic_model_fit <- logistic_model %>% fit(sex ~ height, data = height_train)

broom::tidy(logistic_model_fit)
```

## Assess Model Accuracy

I make predictions on the test set, generating both the class and the probabilities. 

```{r}
## Class predictions
#############################################
logistic_pred_class <- logistic_model_fit %>% predict(new_data = height_test, type = "class")

## Probability predicitions
############################################
logistic_pred_prob <- logistic_model_fit %>% predict(new_data = height_test, type = "prob")
```

I then attach this data to the test dataset

```{r}
height_test_pred <- height_test %>% bind_cols(logistic_pred_class, logistic_pred_prob)
```

### The Confusion Matrix

I generate the confusion matrix and plot it. 

```{r}
height_test_pred %>% conf_mat(truth = sex, estimate = .pred_class)
```
We plot this using both the heatmaps and mosaic plots in that order. 

```{r}
height_test_pred %>% conf_mat(truth = sex, estimate = .pred_class) %>%  autoplot(type = "heatmap")
```

Then the mosaic map;

```{r}
height_test_pred %>% conf_mat(truth = sex, estimate = .pred_class) %>% autoplot(type = "mosaic")
```

The model does a poor job at identifying females but is great at identifying males. 

### Accuracy, Sensitivity and Specificity

I compute the metrics for accuracy, specificity, and sensitivity in that order. 

We start with accuracy

```{r}
## Overall accuracy
height_test_pred %>% accuracy(truth = sex, estimate = .pred_class)
```

Then specificity

```{r}
## Specificity
height_test_pred %>% spec(truth = sex, estimate = .pred_class)
```

Finally, sensitivity

```{r}
## Specificity
height_test_pred %>% sens(truth = sex, estimate = .pred_class)
```

We could have gotten the three metrics together by getting the metric set. 

```{r}
custom_metrics <- metric_set(accuracy, sens, spec, f_meas) 

height_test_pred %>% custom_metrics(truth = sex, estimate = .pred_class)
```

## ROC Curves and Area Under Curve

In this section I get the receiver operating characteristics (ROC) curve and the area under the ROC curve (AUC). 

```{r}
height_test_pred %>% roc_curve(truth = sex, .pred_Male) %>% autoplot()
```

The area under the curve is; 

```{r}
height_test_pred %>% roc_auc(truth = sex, .pred_Male)
```